package Score.pkg;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.URL;

import org.json.JSONObject;

public class ChatGPT1 {

	 // The 'promptTemplate' is a template for the prompt used in the AI model.
    // It provides instructions for scoring extracurricular activities.
    private static String promptTemplate = "You are to evaluate how impactful, meaningful, and authentic the common app essay is for a university in the United States. You must provide a score from one to 100 and a comment about how good the essay is and how it can be better. \n\nEssay: “Oh God, Santiago is complaining again, such an old grandma.”\nThat was my mother’s exclamation when I would tell her my worth-listening-to primary school problems. The truth about my life before 2015 is that I never worried because mom swept away every obstacle. Honestly, I grew up in a bubble, whose colorful reflection blinded me from the truth; soft walls that would swiftly burst. At the age of nine, I successfully joined my province's table tennis team and, one year after, I got into the Ecuadorian National Team. Despite being my happiest achievement, it took me away from mom, slightly stretching my bubble. And in January 2015 a three-month training camp in Germany blurred the rainbow in my bubble, melted its walls into a substance that sunk me into a world I could barely imagine: “reality”.  \n \nThe first week was all about living the longed-for European dream: traveling abroad. Surprisingly, it took just a few days until my body's smell wouldn't let me sleep as my mom wasn’t there to tell me “It’s time to shower”. The embarrassment, stares, sniffs, and teasing forced me to bathe daily. One week later I had no clean clothes, and nobody would pick up my dirty laundry and magically transform them into clean vestments. I had never expected to learn how to use the washing machine via youtube while tasting my salty tears. It was the same with my bed sheets, room and dishes. Every time fewer tears spilled; I hoped it was due to maturity and not dehydration.\n\nRepentance came with hunger when the only thing I swallowed was an air mouthful after I discovered that the meal had already been consumed. I asked my trainer if he saved anything for me, but he replied \"I’m not your servant\". I endured the hunger for two days until necessity pushed me to invention. We were running with snow; everything looked outstanding, but the accumulated ice scraped my legs. I wanted to stop, but I could do nothing but encourage myself to resist, to not faint, to survive. I ran five kilometers between frozen tears; wanting a hug from my mom when I couldn’t even hug myself with my damped arms. When I reached the residence there was no bread and the anger encouraged me to go to the store. Although I saw a half-naked man smoking along the way; I was too hungry to heed my fear; I’d rather please my empty stomach with some two-euro chips. \n\nBeing 11 on another continent, with no local language ability, hungry, ashamed, desperate, scared, and tired was torture that forced me to clean, cook, react, and never again stay silent. Nowadays, I feel proud of that child who cried in the shower and learned that life is more than his mother doing everything; that danger exists and his future depends on his decisions. Soon after, I volunteered at an orphanage where children go through a nightmare beyond what I’ve ever experienced, children who inspire me to work for a change. Later, I got financial aid for secondary education and language courses, and last year I got a scholarship to UWCSEA. I was not 11 anymore, but I chose to leave my nest again in order to become who I want to be. I still fail, but wounds will heal; small scars that in ten years will signify success, not just for me but for orphans who taught me survival skills, for family who taught me love, for friends who taught me trust, for the world that taught me things are not easy. Making the most of these lessons, everything depends on the way I transform myself from a complainer grandma to a social activist. I’m proud to say that since Germany I have solved my own problems and become a self-confident Ecuadorian willing to listen to and accompany people who, as I did in Germany, feel solitary.\n\nComment: This essay is incredibly powerful and authentic. The writer effectively showcases their personal growth and transformation in the face of adversity. The use of specific and vivid details helps the reader understand the challenges the writer faced when navigating a new country and culture. The essay also highlights the writer's determination and resilience, as well as their commitment to using their experiences to make a positive impact on others. Overall, this essay is impactful, meaningful, and authentic.\nScore: 89\n\n\nEssay:  I sat on my parents’ bed weeping with my head resting on my knees. “Why did you have to do that to me? Why did you have to show me the house and then take it away from me?” Hopelessly, I found myself praying to God realizing it was my last resort.\n            \"For years, my family and I found ourselves moving from country to country in hopes of a better future. Factors, such as war and lack of academic opportunities, led my parents to pack their bags and embark on a new journey for our family around the world. Our arduous journey first began in Kuçovë, Albania, then Athens, Greece, and then eventually, Boston, Massachusetts. Throughout those years, although my family always had a roof over our heads, I never had a place I could call “home.”\n\"Instantly, I knew that it was fate that was bringing this house to me.\n            \"That night that I prayed to God, my mind raced back to the night I was clicking the delete button on my e-mails, but suddenly stopped when I came upon a listing of the house. It was September 22, 2007 —eight years exactly to the day that my family and I had moved to the United States. Instantly, I knew that it was fate that was bringing this house to me. I remembered visiting that yellow house the next day with my parents and falling in love with it. However, I also remembered the heartbreaking phone call I received later on that week saying that the owners had chosen another family’s offer.\n            \n             \"A week after I had prayed to God, I had given up any hopes of my family buying the house. One day after school, I unlocked the door to our one-bedroom apartment and walked over to the telephone only to see it flashing a red light. I clicked PLAY and unexpectedly heard the voice of our real estate agent. “Eda!” she said joyfully. “The deal fell through with the other family—the house is yours! Call me back immediately to get started on the papers.” For a moment, I stood agape and kept replaying the words in my head. Was this really happening to me? Was my dream of owning a home finally coming true?\n        \n            Over the month of November, I spent my days going to school and immediately rushing home to make phone calls. Although my parents were not fluent enough in English to communicate with the bank and real estate agent, I knew that I was not going to allow this obstacle to hinder my dream of helping to purchase a home for my family. Thus, unlike a typical thirteen-year-old girl’s conversations, my phone calls did not involve the mention of makeup, shoes, or boys. Instead, my conversations were composed of terms, such as “fixed-rate mortgages,” “preapprovals,” and “down payments.” Nevertheless, I was determined to help purchase this home after thirteen years of feeling embarrassed from living in a one-bedroom apartment. No longer was I going to experience feelings of humiliation from not being able to host sleepovers with my friends or from not being able to gossip with girls in school about who had the prettiest room color.\n\nI had been homeless for the first thirteen years of my life. Although I will never be able to fully repay my parents for all of their sacrifices, the least I could do was to help find them a home that they could call their own—and that year, I did. To me, a home means more than the general conception of “four walls and a roof.” A home is a place filled with memories and laughter from my family. No matter where my future may lead me, I know that if at times I feel alone, I will always have a yellow home with my family inside waiting for me.\n        \n\nComment:  The essay effectively portrays the struggles and aspirations of the writer and showcases the significance of finding a place to call home. The emotional depth and personal anecdotes make the essay impactful and relatable. The writer demonstrates determination and maturity as they navigate the complexities of purchasing a home at a young age.\nTo improve the essay, the writer could provide more specific examples of the challenges they faced during the process of purchasing the house. This would give the readers a clearer understanding of the obstacles they overcame and further highlight their determination. Additionally, the essay could benefit from reflecting on the writer's growth and the lessons they learned from this experience.\n            \n Overall, the essay is meaningful, and authentic, and showcases resilience in the face of adversity.\nScore: 85\n\n\nEssay: Have you ever wondered what lies beneath the façade of each person's smile? For me, 51% of the time they aren't purely happiness.\n\nGrowing up where I did felt like navigating a maze. Your background determines the walls, and your gender becomes the barrier that makes some journeys far more challenging than others. It happened with my grandmother, my mother and why was I gonna be the exception? I was six years old the first time my father told me I would not succeed because I was a girl, I didn’t cry but showed him the most sarcastic smile, a smile he wouldn’t forget. In that moment, I yearned to prove the skeptics wrong, wielding the intangible power of a smile.\n\nI was eight when started working at the same restaurant as my mother during the weekends for 15 USD a day. I remember washing dishes at a velocity I considered fast but every time an enormous tower came over and over again. When I was nine, I could barely feel my legs but I still managed to smile and tell my teacher that I had spent an amazing weekend with my parents. Studying was a privilege I could give myself 5 hours a day because it was the only time I could be like the other children in my class, with no worries no responsibilities, no violence. \n\nBEcambio with Amigos de las Americas was my way of teaching children with my reality that they were as capable as anybody else of achieving amazing things. I pointed myself and had a grin from ear to ear, it was time to smile and start creating hope for the next generations. I had the opportunity to be a coach at the Latin-American Leadership Academy for South American students and teach them about leadership and social innovation. A smile helped me to let them know that I was actively listening, that I was interested in hearing stories but also that I wanted to help them to feel satisfied with who they have become so far. \n\nI was fourteen the first time I enjoyed international communities thanks to a scholarship, telling myself that money was not an impediment. I discovered a world of opportunities abroad for people like me, for people seeking different types of smiles and trying to have a better reality. It was when I felt I was eager to spread my wings. Applying to UWCSEA was an opportunity to seek independence but also a time to feel belonging. Finally, I understood it, I created a smile of validation. It was as if all those afternoons going to cybercafes to present my homework the day after while listening to my favorite band were worth it. I may stumble in my journey, but I'm sculpting myself into a person worthy of my own approving gaze at day's end, someone I'll proudly smile upon.\n\nStudying in Singapore was getting outside my Ecuadorian comfort zone. It was the first time I was leaving my mother with the hope that one day I could give her a joyful expression. “Don’t lose your sparkle and your resilient spirit, because everything was worth it”. That is the advice I want to give to my smiling eight-year-old self. Currently, I feel myself belonging not to a single place, but to a movement formed by people who are similar to me, who want to change their surroundings, people who share the same smiles  That was the time when I realized my smiles were genuine after a long time. \n\nIn a world where smiles often conceal more than they reveal, I've come to understand that behind that cheerful expression, there's a complex tapestry of emotions woven together. It's a tapestry I've become intimately familiar with. For me, 49 percent of the time,  smiles are powerful catalysts for personal growth and empathy.\n\nComment: \nThis essay is incredibly moving and inspiring. The writer effectively narrates their personal journey and does a wonderful job illustrating how they developed resilience and inner strength in the face of adversity. The vivid imagery and specific anecdotes help bring their story to life and make the essay impactful and authentic. To improve the essay, the writer could provide more detail on how their transformational experiences have enabled them to navigate their new home in Singapore. Additionally, they could further explore how their experience have allowed them to understand the power of their smiles. \nOverall, the essay is meaningful, authentic, and impactful. \nScore: 93"

            
            + "Essay: <<ESSAY>>\n"
            + "Comment: "
           ;
    
    // The 'answerMe' method takes an activity description as input, and it uses the OpenAI API to generate a score for it.
    public static String answerMe(String text) throws Exception {
        String prompt = promptTemplate.replace("<<ESSAY>>", text);

        // Initialize the URL for the OpenAI API.
        String url = "https://api.openai.com/v1/completions";
        HttpURLConnection con = (HttpURLConnection) new URL(url).openConnection();

        // Set the HTTP request method and request headers.
        con.setRequestMethod("POST");
        con.setRequestProperty("Content-Type", "application/json");
        con.setRequestProperty("Authorization", "Bearer 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");

        //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
        
        
        // Create a JSON object to hold the API request data, including the prompt.
        JSONObject data = new JSONObject();
        data.put("model", "text-davinci-003");
        data.put("prompt", prompt);
        data.put("max_tokens", 256);
        data.put("temperature", 1.0);

        // Set 'doOutput' to true to allow sending data in the request body.
        con.setDoOutput(true);
        con.getOutputStream().write(data.toString().getBytes());

        // Read the response from the API and extract the generated text.
        String output = new BufferedReader(new InputStreamReader(con.getInputStream())).lines()
                .reduce((a, b) -> a + b).get();

        // Parse the JSON response to get the generated text (the score).
        return (new JSONObject(output).getJSONArray("choices").getJSONObject(0).getString("text"));
    }

    public static void main(String[] args) throws Exception {
        // Example usage of the 'answerMe' method with an activity description.
        System.out.println(answerMe(" this is my essay"));
    }
}